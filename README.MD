# Spotify ‚Üí TIDAL Playlist Migrator (Poetry + Python)

Migra tus playlists de **Spotify** a **TIDAL** de forma automatizada.  
Lee tus playlists con la **Spotify Web API** y crea/equipa las listas en TIDAL usando llamadas HTTP autenticadas (token de `tidalapi`).  
Optimiza el _matching_ por **ISRC** y, si no hay, usa b√∫squeda por texto con filtro de duraci√≥n (¬±2s).

> **Nota:** Este proyecto usa `tidalapi` solo para autenticaci√≥n; las llamadas a la API de TIDAL se hacen con `requests` (controlamos ETag y headers). No es un proyecto oficial de TIDAL.

---

## ‚ú® Caracter√≠sticas

- üß≠ Migra **todas** tus playlists (o filtra por nombre parcial)
- üéØ _Matching_ por **ISRC** (m√°xima precisi√≥n)
- üîé _Fallback_ por `t√≠tulo + artista` con **tolerancia por duraci√≥n**
- üß± Inserci√≥n en **lotes** (configurable) con manejo de ETag (If-None-Match)
- üßæ Genera `not_found.csv` con los temas que no se pudieron mapear

---

## ‚öôÔ∏è Requisitos

- **Python** 3.10‚Äì3.12
- **Poetry** (gestor de dependencias)
- Cuenta de **Spotify** y **TIDAL**
- Acceso al **Spotify Developer Dashboard** para crear tu app y obtener `client_id`/`client_secret`

---

## üöÄ Instalaci√≥n r√°pida

```bash
# 1) Clona el repo
git clone https://github.com/<tu-org>/<tu-repo>.git
cd <tu-repo>

# 2) Instala Poetry (si no lo tienes)
# macOS/Linux:
#   pipx install poetry
# Windows (PowerShell):
#   (Invoke-WebRequest -Uri https://install.python-poetry.org -UseBasicParsing).Content | py -

# 3) Instala dependencias y crea el venv
poetry install
```

## üîê Configura credenciales

### 1. Crea una app en Spotify

1. Ve a Spotify Developer Dashboard ‚Üí Create app y asegurate de copiar el client id y client secret y establecer el url de callback.
2. En Redirect URIs, agrega exactamente: http://127.0.0.1:8080/callback
3. Copia tu Client ID y Client Secret.

### 2) Crea el archivo .env (recuerda no subirlo a tu repo porque tiene informaci√≥n sensible)

```env
# Spotify OAuth
SPOTIFY_CLIENT_ID=tu_client_id
SPOTIFY_CLIENT_SECRET=tu_client_secret
SPOTIFY_REDIRECT_URI=http://127.0.0.1:8080/callback

# (Opcional) Migra solo playlists cuyo nombre contenga esta cadena (case-insensitive)
PLAYLIST_NAME_FILTER=

# Pa√≠s de cat√°logo TIDAL para b√∫squedas (afecta resultados)
TIDAL_COUNTRY=PE

# Tama√±o del lote al insertar pistas en TIDAL
TIDAL_ADD_BATCH=100
```

Nota: SPOTIFY_REDIRECT_URI debe coicidir con el callback establecido en tu app de spotify

## üß© Estructura del proyecto

```bash
.
‚îú‚îÄ pyproject.toml
‚îú‚îÄ .env
‚îî‚îÄ src/
   ‚îî‚îÄ spotify_to_tidal/
      ‚îî‚îÄ main.py
```

## ‚ñ∂Ô∏è Ejecuci√≥n

# Opci√≥n 1: directo

```bash
poetry run spotify-to-tidal
```

Flujo esperado:

Se abre el navegador para autorizar Spotify (primer uso).

En consola ver√°s un enlace de TIDAL para autorizar (c√≥digo expira en 300 s).

El script crear√° cada playlist en TIDAL y a√±adir√° las pistas en lotes.

Si hay temas no encontrados, generar√° not_found.csv.

## üõ†Ô∏è C√≥mo funciona (resumen t√©cnico)

Spotify: se listan playlists y pistas (con external_ids.isrc cuando existe).

Resoluci√≥n TIDAL:

Primero se busca por ISRC (GET /v1/search?query=isrc:<ISRC>&type=tracks).

Si no hay ISRC, se busca "<title> <artist>", y se filtra por duraci√≥n ¬±2s.

Creaci√≥n de playlists en TIDAL:

POST /v1/users/{userId}/playlists.

Inserci√≥n en lotes:

POST /v1/playlists/{uuid}/items requiere ETag vigente v√≠a If-None-Match.

Antes de cada lote se obtiene el ETag actual con GET /v1/playlists/{uuid}/items?limit=1.

Si hay 412 (mismatch de ETag), se reintenta 1 vez con el ETag nuevo.

## ‚öôÔ∏è Par√°metros √∫tiles

Filtrar playlists por nombre: edita PLAYLIST_NAME_FILTER en .env (ej. rock, workout).

Tama√±o de lote: TIDAL_ADD_BATCH (baja a 50 si ves rate-limits).

Cat√°logo TIDAL: cambia TIDAL_COUNTRY (ej. US) si hay muchos ‚Äúno encontrados‚Äù.

## üß™ Consejos de calidad de mapeo

ISRC primero: evita versiones live/remaster.

Fallback por texto + duraci√≥n: √∫til cuando falta ISRC.

Disponibilidad regional: prueba otro TIDAL_COUNTRY.

Revisa not_found.csv: suelen ser pocos, pero √∫tiles para ajustes manuales.

## ‚ùó Problemas comunes

INVALID_CLIENT: Invalid redirect URI (Spotify)
Aseg√∫rate que el Redirect URI en Dashboard coincide exactamente con SPOTIFY_REDIRECT_URI.

412 You must send the correct Etag‚Ä¶ (TIDAL)
Ya est√° implementado el manejo de ETag. Si lo ves, fue un choque puntual y el script reintenta.

401/403 (TIDAL)
Token expirado: repite el login.

Demasiados ‚Äúno encontrados‚Äù
Cambia TIDAL_COUNTRY a US y reintenta.

Rate limit
Baja TIDAL_ADD_BATCH (p. ej. 50) y/o aumenta sleep_s.

## üßπ Mantenimiento

Borrar cache de Spotify:

```bash
rm -f .spotify_cache
```

## üßë‚Äçüíª Contribuir

¬°PRs bienvenidos! Ideas √∫tiles:

- DRY_RUN=1 para simular y solo generar not_found.csv
- Reutilizar playlist si ya existe (por t√≠tulo) en lugar de crear una nueva
- Soporte para exclusiones/inclusiones por patr√≥n
- Tests sobre la l√≥gica de resoluci√≥n (ISRC / fuzzy match)

## ‚öñÔ∏è Licencia

MIT. Consulta el archivo LICENSE.
